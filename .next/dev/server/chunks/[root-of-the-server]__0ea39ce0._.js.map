{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Work/Shortner-updated/git/app/api/links/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport path from 'path';\nimport fs from 'fs/promises';\n\n/**\n * GET handler to retrieve all stored link mappings. The data is stored\n * as an object keyed by id in the JSON file. This endpoint returns\n * that object directly. If the file is missing or invalid, it\n * returns an empty object.\n */\n// The GET handler now accepts a NextRequest so that we can read\n// cookies sent by the client. We return only the entries for the\n// authenticated user. If no authentication cookie is present we\n// respond with a 401 status to indicate that login is required.\nexport async function GET(req: NextRequest) {\n  // Determine which user is making the request. We expect the\n  // frontend to set a cookie named `username` after a successful\n  // login. Without this cookie we cannot scope the returned data\n  // and therefore reject the request.\n  const usernameCookie = req.cookies.get('username');\n  const username = usernameCookie?.value;\n  if (!username) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n  }\n  const dataFile = path.join(process.cwd(), 'data', 'links.json');\n  try {\n    const json = await fs.readFile(dataFile, 'utf8');\n    const linksData = JSON.parse(json) as Record<string, any>;\n    // If the file is organised by id at the root (flat structure),\n    // return all entries so that legacy data remains visible. A\n    // flat structure is detected by checking if any value has an id\n    // property. Otherwise we assume the top-level keys are user\n    // names.\n    const hasFlatEntries = Object.values(linksData).some((v: any) =>\n      v && typeof v === 'object' && 'id' in v\n    );\n    if (hasFlatEntries) {\n      return NextResponse.json(linksData);\n    }\n    const userLinks = linksData[username] ?? {};\n    return NextResponse.json(userLinks);\n  } catch {\n    return NextResponse.json({});\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAYO,eAAe,IAAI,GAAgB;IACxC,4DAA4D;IAC5D,+DAA+D;IAC/D,+DAA+D;IAC/D,oCAAoC;IACpC,MAAM,iBAAiB,IAAI,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,WAAW,gBAAgB;IACjC,IAAI,CAAC,UAAU;QACb,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IACA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;IAClD,IAAI;QACF,MAAM,OAAO,MAAM,gIAAE,CAAC,QAAQ,CAAC,UAAU;QACzC,MAAM,YAAY,KAAK,KAAK,CAAC;QAC7B,+DAA+D;QAC/D,4DAA4D;QAC5D,gEAAgE;QAChE,4DAA4D;QAC5D,SAAS;QACT,MAAM,iBAAiB,OAAO,MAAM,CAAC,WAAW,IAAI,CAAC,CAAC,IACpD,KAAK,OAAO,MAAM,YAAY,QAAQ;QAExC,IAAI,gBAAgB;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B;QACA,MAAM,YAAY,SAAS,CAAC,SAAS,IAAI,CAAC;QAC1C,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CAAC,CAAC;IAC5B;AACF","debugId":null}}]
}