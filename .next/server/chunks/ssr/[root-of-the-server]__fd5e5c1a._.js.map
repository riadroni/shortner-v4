{"version":3,"sources":["turbopack:///[project]/app/[id]/RedirectComponent.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/app/[id]/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/[id]/RedirectComponent.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/[id]/RedirectComponent.tsx\",\n    \"default\",\n);\n","import fs from \"fs/promises\";\nimport path from \"path\";\nimport { notFound } from \"next/navigation\";\nimport RedirectComponent from \"./RedirectComponent\";\n\n// Force runtime rendering and disable static regeneration. Without this,\n// Next.js may try to pre-render pages and not pick up new entries in\n// the JSON file, which would lead to a 404 for dynamic ids.\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n\ninterface LinkEntry {\n  id: string;\n  image: string;\n  urlMobile: string;\n  urlDesktop?: string;\n}\n\n/**\n * Server component that resolves the provided id to a stored link entry.\n *\n * If the id exists in the data store, it renders a client component that\n * displays the loading image and performs a timed redirect. Otherwise it\n * triggers the notFound() helper to render the 404 page.\n */\nexport default async function Page({ params }: { params: Promise<{ id: string }> }) {\n  // Params is a promise in Next.js 15; we must await it to retrieve the id\n  const { id } = await params;\n  const dataFile = path.join(process.cwd(), 'data', 'links.json');\n  // Read the data file. If it's missing or invalid, initialise linksData to\n  // an empty object instead of returning early. This avoids inadvertently\n  // triggering a 404 due to a parse error or missing file.\n  let linksData: Record<string, any> = {};\n  try {\n    const json = await fs.readFile(dataFile, 'utf8');\n    linksData = JSON.parse(json);\n  } catch {\n    linksData = {};\n  }\n  // Determine if the data is flat or nested. If flat, look up the id\n  // directly. If nested, search through all user namespaces to find\n  // the entry. If not found return a 404.\n  const hasFlatEntries = Object.values(linksData).some(\n    (v: any) => v && typeof v === 'object' && 'id' in v\n  );\n  let entry: LinkEntry | undefined;\n  if (hasFlatEntries) {\n    entry = linksData[id] as LinkEntry;\n  } else {\n    for (const user of Object.keys(linksData)) {\n      const userEntries = linksData[user] ?? {};\n      if (userEntries && typeof userEntries === 'object' && id in userEntries) {\n        entry = userEntries[id] as LinkEntry;\n        break;\n      }\n    }\n  }\n  if (!entry) {\n    return notFound();\n  }\n  return (\n    <RedirectComponent\n      image={entry.image}\n      urlMobile={entry.urlMobile}\n      urlDesktop={entry.urlDesktop}\n    />\n  );\n}"],"names":[],"mappings":"kZAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,gSAAkS,EAC/T,+DACA,8DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAU,AAAJ,MAAU,4QAA8Q,EAC3S,2CACA,kICLJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAsBe,eAAe,EAAK,QAAE,CAAM,CAAuC,EAEhF,IAkBI,EAlBE,IAAE,CAAE,CAAE,CAAG,MAAM,EACf,EAAW,EAAA,OAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAI,OAAQ,cAI9C,EAAiC,CAAC,EACtC,GAAI,CACF,IAAM,EAAO,MAAM,EAAA,OAAE,CAAC,QAAQ,CAAC,EAAU,QACzC,EAAY,KAAK,KAAK,CAAC,EACzB,CAAE,KAAM,CACN,EAAY,CAAC,CACf,CAQA,GAJuB,CAInB,MAJ0B,MAAM,CAAC,GAAW,AAI5B,IAJgC,CAClD,AAAC,GAAW,GAAkB,UAAb,OAAO,GAAkB,OAAQ,GAIlD,EAAQ,CAAS,CAAC,EAAG,MAErB,IAAK,IAAM,KAAQ,OAAO,IAAI,CAAC,GAAY,CACzC,IAAM,EAAc,CAAS,CAAC,EAAK,EAAI,CAAC,EACxC,GAAI,GAAsC,UAAvB,OAAO,GAA4B,KAAM,EAAa,CACvE,EAAQ,CAAW,CAAC,EAAG,CACvB,KACF,CACF,QAEF,AAAK,EAIH,CAAA,CAJE,CAIF,EAJU,AAIV,GAAA,EAAC,EAAA,OAAiB,CAAA,CAChB,MAAO,EAAM,KAAK,CAClB,UAAW,EAAM,SAAS,CAC1B,WAAY,EAAM,UAAU,GANvB,CAAA,EAAA,EAAA,QAAQ,AAAR,GASX,kCA3DuB,+BACG","ignoreList":[0]}